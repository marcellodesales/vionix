name: Env pairs to dot env file
description: Generate a .env file with the given contents

author: seceng-devsecops-platform

branding:
  icon: anchor
  color: blue

inputs:
  dot-file-content:
    description: "The content of the .env file to be loaded"
    required: true

  dot-file-artifact-name:
    description: "The name of the artifact to be uploaded"
    required: true

  dot-file-path:
    description: "Path to the file to be uploaded"
    required: false
    default: .env

runs:
  using: composite
  steps:

    - name: Show the current env
      shell: bash
      run: env

    - name: Setup additional credentials based on the given .env file
      shell: bash
      env:
        DOCKER_EXTRA_BUILD_ENVS: '${{ inputs.dot-file-content }}'
      run: |
        echo "Encoding extra env vars"
        echo "${DOCKER_EXTRA_BUILD_ENVS}"
        echo "${DOCKER_EXTRA_BUILD_ENVS}" | base64 > ${{ inputs.dot-file-path }}

        echo "Encoded build envs"
        cat ${{ inputs.dot-file-path }}

        echo "Testing encoded..."
        cat ${{ inputs.dot-file-path }} | base64 -d

    - name: Upload extra envs for the build
      uses: actions/upload-artifact@v3.2.1-node20
      with:
        name: ${{ inputs.dot-file-artifact-name }}
        path: ${{ inputs.dot-file-path }}
        include-hidden-files: true
        if-no-files-found: error

