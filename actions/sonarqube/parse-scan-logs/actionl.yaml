name: sonarqube-parse-scan-logs-action
description: Fetches the sonarqube scan action to parse the result, retrieve results, etc. 

author: vionix

branding:
  icon: anchor
  color: blue

inputs:
  github-token:
    description: "The github token"
    required: true
  wsonarqube-step-name:
    description: "The ID of the workflow run from "
    required: true

outputs:
  log-content:
    description: "The contents of the workflow log"
    value: ${{ steps.sonarqube-workflow.outputs.log-content }}

runs:
  using: composite
  steps:
    - name: Make additional workflow properties
      id: workflow-metadata
      uses: qoomon/actions--context@v4

    - name: Show additional envs
      run: env
    
    - name: Retrieve the logs from the workflow
      id: sonarqube-workflow
      uses: seceng-devsecops-platform/devsecops-platform-github-workflows/actions/github/workflow-run-logs@main
      with:
        github-token: ${{ inputs.github-token }}
        workflow-run-id: ${{ steps.workflow-metadata.outputs.run_id }}
        workflow-run-attempt-id: ${{ steps.workflow-metadata.outputs.run_attempt: }}
        filter-by-step-name: ${{ inputs.sonarqube-step-name }}

    - name: Show the logs for now
      run: |
        echo "Current logs"
        echo "'${{ toJSON(steps.sonarqube-workflow.outputs) }}'" | jq
    
